@{
    Layout =null;
}

<!DOCTYPE html>

<html>
<head>
    <title></title>
   @*  <link href="../../Content/Css/font-awesome.min.css" rel="stylesheet" type="text/css" />   *@
    <link href="../../Content/Css/bootstrap.css" rel="stylesheet" type="text/css" />
     <link href="../../Content/Css/bootstrap-theme.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/Css/button.css" rel="stylesheet" type="text/css" />
     @*按钮开关样式*@
    <link href="../../Content/Css/flat-ui.css" rel="stylesheet" type="text/css" />
    <!--[if IE 7]>
     <link href="../../Content/Font-Awesome-3.2.1/css/font-awesome-ie7.min.css" rel="stylesheet"
        type="text/css" />
    <![endif]-->
    <script src="../../Scripts/jquery-1.8.3.min.js" type="text/javascript"></script>
    <script src="../../Scripts/json2.js" type="text/javascript"></script>
     @*开关按钮引用start *@
    <script src="../../Scripts/JSFlatUI/bootstrap.min.js" type="text/javascript"></script>
    <script src="../../Scripts/JSFlatUI/bootstrap-select.js" type="text/javascript"></script>
    <script src="../../Scripts/JSFlatUI/bootstrap-switch.js" type="text/javascript"></script> 
    <script src="../../Scripts/JSFlatUI/jquery.tagsinput.js" type="text/javascript"></script> 
    <script src="../../Scripts/JSFlatUI/jquery.placeholder.js" type="text/javascript"></script>   
    <script src="../../Scripts/JSFlatUI/application.js" type="text/javascript"></script>
  @*  开关按钮 end*@

    
    <script language="javascript" type="text/javascript">
        $(document).ready(function () {
            var Id = $("#GUID").val(); //""表示新增  有值 表示修改

            if (Id == "" || Id == undefined) {

                $("#btn_signIn").show(); //
                $("#btn_save").hide();
            }
            else {

                $("#btn_signIn").hide(); //
                $("#btn_save").show();
            }
            debugger
            SetDefault(Id);
            $("#btn_save").bind("click", Save);
            $("#btn_signIn").bind("click", Save);


        });
        var nameValid = false;
        var loginKeyValid = false;
        ///spanLoginKeyMsg
        function CheckLoginKey(e) {

            var LoginKey = $("#LoginKey").val();

            if (CheckLoginKeyData(LoginKey) == false) return;
            $.ajax({
                url: "/Account/Validation",
                data: { col: "LoginKey", value: LoginKey },
                dataType: "JSON",
                type: "POST",
                success: function (data) {
                    var imageName = $("#imgLoginKeyMsg")[0];
                    imageName.style.display = "block";

                    if (data != null) {
                        if (data.result == 1) {
                            imageName.src = "../../Content/Img/imageSuccess.jpg";
                            loginKeyValid = true;
                        }
                        else {
                            imageName.src = "../../Content/Img/imageError.jpg";
                            $("#spanLoginKeyMsg").html("<font color='red'>此账号已经注册！</font>");


                        }
                    }
                    else {
                        imageName.src = "../../Content/Img/imageError.jpg";
                        $("#spanLoginKeyMsg").html("<font color='red'>校验失败！</font>");

                    }
                },
                error: function () {
                    var imageName = $("#imgLoginKeyMsg");
                    imageName.style.display = "block";
                    imageName.src = "../../Content/Img/imageError.jpg";
                    $("#spanLoginKeyMsg").html("<font color='red'>网络原因，校验失败！</font>");
                }

            });
        }
        function CheckName(e) {
            //focus()
            var oName = $("#Name");
            var Name = oName.val();
            if (CheckNameData(Name) == false) return;
            $.ajax({
                url: "/Account/Validation",
                data: { col: "Name", value: Name },
                dataType: "JSON",
                type: "POST",
                success: function (data) {
                    var imageName = $("#imgNameMsg")[0];
                    imageName.style.display = "block";

                    if (data != null) {
                        if (data.result == 1) {
                            imageName.src = "../../Content/Img/imageSuccess.jpg";
                            nameValid = true;
                        }
                        else {
                            imageName.src = "../../Content/Img/imageError.jpg";
                            $("#SpanNameMsg").html("<font color='red'>此用户已经注册！</font>");


                        }
                    }
                    else {
                        imageName.src = "../../Content/Img/imageError.jpg";
                        $("#SpanNameMsg").html("<font color='red'>校验失败！</font>");


                    }
                },
                error: function () {
                    var imageName = $("#imgNameMsg");
                    imageName.style.display = "block";
                    imageName.src = "../../Content/Img/imageError.jpg";
                    $("#SpanNameMsg").html("<font color='red'>网络原因，校验失败！</font>");

                }

            });
        }

        function Save() {
            //检查
            if (Check() == false) return;
            var Id = $("#GUID").val(); //""表示新增  有值 表示修改  
            if (Id == "" || Id == undefined) { //添加
                if (nameValid == false) {

                    var imageName = $("#imgNameMsg")[0];
                    imageName.src = "../../Content/Img/imageError.jpg";
                    $("#SpanNameMsg").html("<font color='red'>此用户已经注册！</font>");
                }
                if (loginKeyValid == false) {
                    var imageName = $("#imgLoginKeyMsg")[0];
                    imageName.src = "../../Content/Img/imageError.jpg";
                    $("#spanLoginKeyMsg").html("<font color='red'>此账号已经注册！</font>");
                    return
                }
            }

            var Name = $("#Name").val();
            var LoginKey = $("#LoginKey").val();
            var Address = $("#Address").val();
            var Phone = $("#Phone").val();
            var isStop = $("#Stoped").attr("checked");
            var Stoped = (isStop == "checked" || isStop == "true") ? true : false;
            // data["CreateDate"] = $("#CreateDate").val();
            // data["ModifyDate"] = $("#ModifiedDate").val();
            var Password = $("#Password").val();
            // data["OrderNumber"] = $("#OrderNumbet").val();
            var Creator = $("#Creator").val();
            var Id = $("#GUID").val();
            var data = { Name: Name, LoginKey: LoginKey, Address: Address, Phone: Phone, Stoped: Stoped, Password: Password, Id: Id, Creator: Creator };
            $.ajax({
                url: "/Account/Save",
                data: data,
                dataType: "JSON",
                type: "POST",
                success: function (data) {
                    if (data != null) {
                        if (data.result == 0) {
                            alert("保存成功！");
                        }
                        else {
                            alert("保存失败！");
                        }
                    }
                    else {
                        alert("保存失败！");
                    }
                }

            });
        }
        function SetDefault(id) {
            if (id != "") {
                $("#Name").attr("disabled", "disabled");
                $("#LoginKey").attr("disabled", "disabled");
            }
        }
        function Close() {
            if (confirm('确定要关闭吗?')) {
                window.opener = null;
                window.open("", "_self");
                window.close();
            }
        }

        function CheckNameData(Name) {
            if (Name == "" || Name == undefined) {               
                ClearMsgImage("imgNameMsg");
                $("#SpanNameMsg").html("<font color='red'>公司名称不能为空！</font>");
                return false;
            }
            else {
                var nameLen = Name.length;
                if (nameLen > 50) {                   
                    ClearMsgImage("imgNameMsg");
                    $("#SpanNameMsg").html("<font color='red'>公司名称字符长度不能大于50！</font>");
                    return false;
                }
                else {
                    $("#SpanNameMsg").html("");
                }
            }
            return true;
        }

        function CheckLoginKeyData(LoginKey) {
            if (LoginKey == "" || LoginKey == undefined) {  
            debugger              
                ClearMsgImage("imgLoginKeyMsg");
                $("#spanLoginKeyMsg").html("<font color='red'>账号名称不能为空！</font>");
                return false;
            }
            else {
                var LoginKeyLen = LoginKey.length;
                if (LoginKeyLen > 50) {                    
                    ClearMsgImage("imgLoginKeyMsg");
                    $("#spanLoginKeyMsg").html("<font color='red'>账号最长不能超过50！</font>");
                    return false;
                }
                else {
                    $("#spanLoginKeyMsg").html("");
                }
            }
            return true
        }
        //清除消息图片
        function ClearMsgImage(id) {
            var imageName = $("#" + id)[0];
            imageName.style.display = "none";
            imageName.src = "";
        }
        //校验Phone
        function CheckPhone() {
            var Phone = $("#Phone").val();
            if (Phone == "") {
                $("#SpanPhoneMsg").html("<font color='red'>电话不能为空！</font>");
                return false;
            }
            else {

                if (istell(Phone) == false) {
                    $("#SpanPhoneMsg").html("<font color='red'>电话格式不正确！<br> 格式：固定电话 0511-4405222 或 021-87888822 <br> 或者手机号码</font>");
                    return false;
                }
                var PhoneLen = Phone.length;
                if (PhoneLen > 20) {
                    $("#SpanPhoneMsg").html("<font color='red'>电话最长不能超过20字节！</font>");
                    return false;
                }
                else {
                    $("#SpanPhoneMsg").html("");
                }
            }

            return true;
        }
        function Check() {

            var Name = $("#Name").val();
            if (CheckNameData(Name) == false) {
                return false
            }
            var LoginKey = $("#LoginKey").val();

            if (CheckLoginKeyData(LoginKey) == false) {
                return false;
            }
            var Password = $("#Password").val();
            if (Password == "") {
                $("#SpanPasswordMsg").html("<font color='red'>密码不能为空!</font>");
                return false;
            }
            else {
                var PasswordLen = Password.length;
                if (PasswordLen > 50) {
                    $("#SpanPasswordMsg").html("<font color='red'>密码最长不能超过50字节！</font>");
                    return false;
                }
                else {
                    $("#SpanPasswordMsg").html("");
                }
            }
            var Address = $("#Address").val();
            if (Address == "") {
                $("#SpanAddressMsg").html("<font color='red'>地址不能为空！</font>");
                return false;
            }
            else {
                var AddressLen = Address.length;
                if (AddressLen > 150) {
                    $("#SpanAddressMsg").html("<font color='red'>地址最长不能超过150！</font>");
                    return false;
                }
                else {
                    $("#SpanAddressMsg").html("");
                }
            }
            if (CheckPhone() == false) {return false; }
            //var Stoped = $("#Stoped").val() == "1" ? true : false;
            // var Id = $("#GUID").val();
            return true;
        }

        //匹配国内电话号码(0511-4405222 或 021-87888822)
        function istell(str) {
            //        var result = str.match(/\d{3}-\d{8}|\d{4}-\d{7}/);
            //        var phone = str.match(/^1[35]\d{9}$/);
            //        if (result == null && phone == null) return false;

            var reg1 = /\d{3}-\d{8}|\d{4}-\d{7}/;
            var reg2 = /^1[35]\d{9}$/;
            var result = reg1.test(str);
            var phone = reg2.test(str);
            if (result == false && phone == false) {
                return false;
            }
            return true;
        }
    </script>
    <style type="text/css">
        table
        {
            width:100%;
            height:300px;
            text-align:center;
           
            
        }
        tr 
        {
           
             height:30px;    
        }
        td 
        {
            width:450px;
            
        }
        .tdtitle
        {
            text-align:left; 
            width:50px;
              
        }
        .tdText
        {
             text-align:left;  
             width:450px; 
         
             
        }
        
       *{padding: 0px;margin: 0px; font-size: 13px;font-family:"微软雅黑","SimSun","Arial Narrow";}

        .accountinfo p{width:400px;padding-bottom: 10px;}
        .accountinfo p label{display: block;height:26px;line-height: 26px;}
       
        input{border: 1px solid #ccc;border-radius: 4px;height: 24px;line-height: 24px;vertical-align:middle;}
        input[type=checkbox]{border: 1px solid #fff;}
        input[type="text"]:focus,
        input[type="password"]:focus{
            border-color: rgba(82, 168, 236, 0.8);
            outline: 0;
            outline: thin dotted \9;
            /* IE6-9 */
            -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(82,168,236,.6);
            -moz-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(82,168,236,.6);
            box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(82,168,236,.6);
        }
        input
        {
             width:400px; 
              height:40px;   
        }
        span
        {
            float:left;    
        }
       
       
    </style>
    
     
</head>
<body style="background: #f6f6f6; border:0px"> @*background: #f6f6f6;*@
    <div style="text-align:center;margin: 0px auto; " class="accountinfo">
    <form  id="from" class="form-horizontal">
    <fieldset style="text-align:center">
        
       <div style="text-align:left; margin:0px auto; padding:10px 0px 0px 100px" >
        <a class="button button-rounded button-flat-primary" id="btn_signIn" href="#"><i class="icon-save"></i>注册</a> 
        <a class="button button-rounded button-flat-primary" id="btn_save" href="#"><i class="icon-save" style="display:none"></i>确定</a>  &nbsp &nbsp&nbsp&nbsp&nbsp
        <a class="button button-rounded button-flat-primary" id="btn_close" onclick="Close()" href="#"><i class="con-off"></i>关闭</a>

       </div> 
       <hr />
      @* <div style="margin: 0px auto; padding: 0px; width: 915px; height: 8px; background: url(../../Content/Img/topborder.jpg)">*@
          
       </div>
       <div style="margin: 0px auto; padding:0px 0px 0px 100px; width: 100%; height: auto; "> @*background: url(../../Content/Img/border.jpg)*@
           
        <table>

         @*<tr>
            <td height="65"  style="width:900px" colspan="2" align="center">
                <img src="../../Content/Img/titleMsg.jpg" />
            </td>
          </tr>*@

         <tr>
            <td class="tdText"> 
            
             <label><font color="red">*</font>公司名 &nbsp </label>  
             <div>                             
             <input placeholder="请输入公司名称" id="Name" name="Name" onblur="CheckName(this)" value="@ViewData["Name"]" class="input-xlarge" type="text" />
             </div>          
              <div>
               <span id="SpanNameMsg"></span> 
              </div>         
            </td>

             <td class="tdtitle" >
             <span><img  id="imgNameMsg"src="" style="display:none"/></span>             
             </td>    

         <td class="tdText" >
            <div> 
            <label>订单号  &nbsp </label>
            <input disabled="disabled" id="OrderNumber" value="@ViewData["OrderNumber"]" name="OrderNumber" class="input-xlarge" type="text" />
            </div>
            
            </td>
             <td class="tdtitle" ></td>
        </tr>       
         <tr> 
            
            <td class="tdText" >
            
            <label><font color="red">*</font>账号  &nbsp </label>
            <div> 
            <input placeholder="请输入用户名称" id="LoginKey" value="@ViewData["LoginKey"]" onblur="CheckLoginKey()" name="LoginKey" class="input-xlarge" type="text" />            
            </div>  
             <div>
               <span id="spanLoginKeyMsg"></span>
             </div>        
            </td>
             <td class="tdtitle" >
             <span><img  id="imgLoginKeyMsg"src="" style="display:none"/></span>
           
             </td>

            <td class="tdText"> 
            
            <label ><font color="red">*</font>密码 &nbsp </label>
            <div> 
            <input placeholder="请输入密码" id="Password" name="Password" value="@ViewData["Password"]" class="input-xlarge" type="text" />
            </div>
            <div>
            <span id="SpanPasswordMsg"></span>
            </div>
            </td>
            <td class="tdtitle">             
           </td>

        </tr>        
        
         <tr>           
           
            <td class="tdText" >
            
            <label><font color="red">*</font>电话  &nbsp </label>
            <div> 
            <input placeholder="请输入电话" class="input-xlarge" id="Phone" onblur="CheckPhone()" name="Phone" value="@ViewData["Phone"]" type="text" />
            </div>
             <div>
             <span id="SpanPhoneMsg"></span>
             </div>
           
            </td>
            <td class="tdtitle">
                
            </td>
            
            <td class="tdText"> 
            <div> 
            <label >创建人&nbsp </label>
            <span><input class="input-xlarge" disabled="disabled" id="CreateorId" name="CreateorId" value="@ViewData["CreateorName"]" type="text" />
            </div>
           
            </td>
          <td class="tdtitle"></td> 
         
        </tr>

         <tr>
           
            <td class="tdText"> 
           
            <label >创建时间  &nbsp </label>

             <div><input class="input-xlarge" id="CreateDate" disabled="disabled" name="CreateDate" value="@ViewData["CreateDate"]"  type="text" />
             </div>
           
            </td>
            <td class="tdtitle"></td>
            
            <td class="tdText" >
          
            <label >修改时间  &nbsp </label>
            <div>
           <input  class="input-xlarge" disabled="disabled" id="ModifiedDate" name="ModifiedDate" value="@ViewData["ModifiedDate"]" type="text" />
           </div>
         
            </td>
         <td class="tdtitle"></td>

        </tr>
               

        <tr>
           
            <td class="tdText" colspan="4">
            
            <label ><font color="red">*</font>地址  &nbsp </label>
            <div>
            <input placeholder="请输入地址" style=" width:850px" class="input-xlarge" id="Address" name="Address" value="@ViewData["Address"]"  type="text" />
            </div>
            <div><span id="SpanAddressMsg"></span></div>
                       
        </tr>
        <tr>
            
            <td class="tdText">
            
            <label>可用  &nbsp </label>           
            <div > 
                <input data-toggle="switch" type="checkbox" id="Stoped" name="Stoped" checked="@ViewData["Stoped"]" />

            </div> 

            </td>
            <td class="tdtitle"></td>
            <td></td>
            <td></td>
        </tr>
        
      </table>
       </div>

       @*<div style="margin: 0px auto;  padding: 0px; width: 915px; height: 24px; background: url(../../Content/Img/bottom.jpg)">
           
       </div>*@

      <hr>
      <div>       
       <input  id="Creator"  type="hidden" value="@ViewData["Creator"]" />
        <input id="GUID" name="Id" type="hidden" value="@ViewData["Id"]" />
      </div>
      
      
    </fieldset>     
  </form>
    </div>
</body>
</html>
