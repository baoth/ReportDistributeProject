@{
    Layout =null;
}

<!DOCTYPE html>

<html>
<head>
    <title></title>
    <style>
        *{padding: 0px;margin: 0px; font-size: 13px;font-family:"微软雅黑","SimSun","Arial Narrow";}
    </style>
       <link href="../../Content/Css/Switch/bootstrap-switch.css" rel="stylesheet" type="text/css" /> 
     <link href="../../Content/Css/bootstrap-theme.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/Css/button.css" rel="stylesheet" type="text/css" />   
        <link href="../../Content/Css/Upload/basic.css" rel="stylesheet" type="text/css" />
    <link href="../../Content/Css/Upload/dropzone.css?r=32" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/jquery-1.8.3.min.js" type="text/javascript"></script>        
        <script src="../../Scripts/layer.js?r=2" type="text/javascript"></script>
           <script src="../../Scripts/dropzone.js?r=2" type="text/javascript"></script>

           
    <script src="../../Scripts/Switch/bootstrap-switch.js" type="text/javascript"></script>   
       <style type="text/css">
        table
        {
            width:100%;
            height:250px;
            text-align:center;
           
            
        }
        tr 
        {
           
             height:20px;    
        }
        
        .tdText
        {
             text-align:left;
             width:40%; 
             vertical-align:top;
            
             
        }
        
   

        .accountinfo p{width:400px;padding-bottom: 10px;}
        .accountinfo p label{display: block;height:26px;line-height: 26px;}
       
        input{border: 1px solid #ccc;border-radius: 4px;height: 24px;line-height: 24px;vertical-align:middle;}
        input[type=checkbox]{border: 1px solid #fff;}
        input[type="text"]:focus,
         input[type="text"]
        {
             width:50%; 
             height:30px;
             padding:2px; 
               
        }
        
       
    </style>
    <script>
        function CheckField(id) {
            var ele = $("#"+id).val();
            if (ele == "") {
                $("#" + id + "Msg").html("<font color='red'>该字段不能为空！</font>");
                return false;
            } else {
                $("#" + id + "Msg").html('');
                return true;
            }

        };
        function CheckName(e) {

            var reportKey = $("#txtGJZ").val();

            if (CheckField(tableName) == false) return false;
            $.ajax({
                url: "/FReportMain/Validation",
                data: { col: "ReportKey", value: ReportKey },
                dataType: "JSON",
                type: "POST",

                success: function (data) {
                    var imageName = $("#imgLoginKeyMsg")[0];
                    imageName.style.display = "block";

                    if (data != null) {
                        if (data.result == 1) {
                            imageName.src = "../../Content/Img/imageSuccess.jpg";
                            loginKeyValid = true;
                            return true;
                        }
                        else {
                            imageName.src = "../../Content/Img/imageError.jpg";
                            $("#spanLoginKeyMsg").html("<font color='red'>此账号已经注册！</font>");


                        }
                    }
                    else {
                        imageName.src = "../../Content/Img/imageError.jpg";
                        $("#spanLoginKeyMsg").html("<font color='red'>校验失败！</font>");

                    }
                },
                error: function () {
                    var imageName = $("#imgLoginKeyMsg");
                    imageName.style.display = "block";
                    imageName.src = "../../Content/Img/imageError.jpg";
                    $("#spanLoginKeyMsg").html("<font color='red'>网络原因，校验失败！</font>");
                }

            });
            return false;
        }
    var PageAction = function () {
        function GoBack() {
            var urlaccount = '/FReportMain/Grid';
            window.parent.ControlIFrame(urlaccount);

        }
        function Look() {debugger
            var url = $('#txtUrl').val();
            if (url) {
                window.open(url);
            }
        }
        function Save() {
            var data = { Id: $('#txtGUID').val() }
            if (!CheckField('txtGJZ') || !CheckField('txtBBMC') || !CheckField('txtUrl')) {
                return;
            }
            data.ReportKey = $('#txtGJZ').val();
            data.Title = $('#txtBBMC').val();
            /*todo*/
            $.ajax({
                url: "/FReportMain/Save",
                data: data,
                dataType: "JSON",
                type: "POST",
                success: function (data) {
                    if (data != null) {
                        if (data.result == 0) {
                            layer.msg("操作成功！");
                            new PageAction().GoBack();
                        }
                        else {
                            layer.msg("保存失败！");
                        }
                    }
                    else {
                        layer.msg("保存失败！");
                    }
                }

            });
        }
        return {
            GoBack: GoBack,
            Save: Save,
            Look: Look
        }
    };
    $(document).ready(function () {

        $('#b-close,#b-save,#b-look').bind('click', function () {
            var action = $(this).attr('action');
            new PageAction()[action]();
        });
        $(".dropzone").dropzone({
            url: "/FReportMain/Upload",
            addRemoveLinks: true,
            dictRemoveLinks: "x",
            dictCancelUpload: "x",
            maxFiles: 1,
            maxFilesize: 5,
            acceptedFiles: ".xls",
            init: function () {

                this.on("success", function (file, responseText, s) {
                    debugger
                    $('#txtUrl').val(responseText.data);
                    $('#b-look').removeClass("disabled");
                });
                this.on("removedfile", function (file) {
                    $('#txtUrl').val('');
                    $('#b-look').addClass("disabled");
                });
            }
        });
        $("#CheckSwitch").bootstrapSwitch({
            onText: '启用',
            offText: '停用',
            state: $('#txtStop').val() != '1'
        });

    })
    </script>
</head>
<body style="background: #f6f6f6; border:0px; margin:10px;"> @*background: #f6f6f6;*@
       <div style="margin: 0px auto; width: 100%; height: auto; "> @*background: url(../../Content/Img/border.jpg)*@
        <table width="100%">
        <tr>
             <div style="text-align:left; margin:0px auto;" >
        <a class="button button-rounded button-flat-highlight" id="b-close" action="GoBack" href="#">返回</a>
        <a class="button button-rounded button-flat-action" id="b-save" action="Save" href="#">保存</a>
        <a class="button button-rounded button-flat-caution disabled" id="b-look" action="Look" href="#">预览</a>
       </div> 
        </tr>
         
               

        <tr>
             <td class="tdText">
            <label ><font color="red">*</font>报表名称  &nbsp </label>
            <div>
             <input placeholder="请输入报表名称" maxlength="100" class="input-xlarge" id="txtBBMC" onblur="CheckField('txtBBMC')" name="txtBBMC" value="@ViewData["Title"]"  type="text" />
             
            </div>
             <div id="txtBBMCMsg"></div>
             </td>
            <td class="tdText" >
            
          
            <div class="form-group has-success has-feedback">
              <label class="control-label" for="inputSuccess2">关键字</label>
              <input placeholder="请输入关键字" type="text" class="form-control" id="txtGJZ" onblur="CheckField('txtGJZ')" name="txtGJZ" value="@ViewData["ReportKey"]">
              <span class="glyphicon glyphicon-ok form-control-feedback"></span>
            </div>
            <div id="txtGJZMsg"></div>
            </td>
           
        </tr>
          <tr>
             <td class="tdText" colspan="2">
            
            <label ><font color="red">*</font>生成URL  &nbsp </label>
            <div>
             <input disabled=disabled placeholder="" style="width:75%" maxlength="100" class="input-xlarge" id="txtUrl" value="@ViewData["ReportKey"]"  type="text" />
             
            </div>
             <div id="txtUrlMsg"></div>
            </td>
        </tr>
                 <tr>
            
            <td class="tdText">
            
            <label> &nbsp </label>           
            <div > 
             <input id="CheckSwitch" type="checkbox" />
            </div> 

            </td>
        </tr>
     
      </table>
       </div>
       <div  class="dropzone" ></div>
      @* <iframe id='itest' style="top:400px;width:100%;height:400px;position:absolute;z-index:1;" frameborder=0 src="http://www.baidu.com" scrolling=auto >*@
       
       <input id="txtGUID" name="txtGUID" type="hidden" value="@ViewData["Id"]" />
       <input id="txtStop" name="txtGUID" type="hidden" value="@ViewData["Stoped"]" />
 
</body>
</html>
